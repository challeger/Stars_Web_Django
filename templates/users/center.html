{% extends 'base.html' %}
{% load static %}
{% block title %}个人中心{% endblock %}
{% block css %}
    <link href="https://cdn.bootcdn.net/ajax/libs/cropper/4.0.0/cropper.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'users/css/center-style.css' %}">
{% endblock %}
{% block body %}
    <!-- Recharge Modal -->
    <div class="modal fade" id="rechargeModal" tabindex="-1" role="dialog" aria-labelledby="rechargeModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="rechargeModalLabel">充值</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <label for="rechargeNum">充值金额:</label>
                    <input type="text" id="rechargeNum">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="recharge();">充爆!</button>
                </div>
            </div>
        </div>
    </div>
    <!-- upload head Modal -->
    <div class="modal fade" id="upload-modal" data-backdrop="static" aria-labelledby="uploadModalLabel"
         aria-hidden="true" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="uploadModalLabel">请选择合适的区域作为头像</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="img-container">
                        <img id="uploadPreview" src="" style="width: auto; height: auto;"
                             class="img-responsive center-block">
                    </div>
                    <div id="error_text" style="display:none"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" type="button" data-dismiss="modal">取消</button>
                    <button class="btn btn-secondary" id="sendPhoto" type="button">上传</button>
                </div>
            </div>
        </div>
    </div>
    <div class="site-wrapper">
        <!-- header -->
        <header class="left float-left shadow-dark" id="header">
            <button type="button" class="close" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            <div class="header-inner d-flex align-items-start flex-column">
                <a href="#"><img class="avatar mx-auto d-block img-thumbnail" src="/media/{{ request.user.avatar }}"
                                 alt="{{ request.user }}"/></a>
                <a href="#" class="site-title mt-3">{{ request.user }}</a>
                <span class="site-slogan">{{ request.user.desc }}</span>

                <!-- navigation menu -->
                <nav>
                    <ul class="vertical-menu scrollspy">
                        <li><a href="#shelf">
                            <svg t="1601956299595" class="icon" viewBox="0 0 1097 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" p-id="2226" width="22" height="22">
                                <path d="M998.58390632 852.14701166H126.84569332A41.51236 41.51236 0 0 0 85.33333332 893.65937166v62.26854a41.51236 41.51236 0 0 0 41.51236 41.51236h871.738213a41.51236 41.51236 0 0 0 41.51236-41.51236v-62.26854a41.51236 41.51236 0 0 0-41.51236-41.51236z m-29.293426 83.014048h-813.172704a8.537246 8.537246 0 0 1-8.537246-8.537246v-3.681687a8.537246 8.537246 0 0 1 8.537246-8.537247h813.172704a8.537246 8.537246 0 0 1 8.537246 8.537247v3.681687a8.537246 8.537246 0 0 1-8.537246 8.537246zM126.84569332 810.63465166h124.537079a41.51236 41.51236 0 0 0 41.51236-41.51236V229.47228566a41.51236 41.51236 0 0 0-41.51236-41.51236H126.84569332A41.51236 41.51236 0 0 0 85.33333332 229.47228566v539.650006a41.51236 41.51236 0 0 0 41.51236 41.51236zM156.72605532 246.49342066h64.883071a12.805869 12.805869 0 0 1 12.805869 12.805869v479.995998a12.805869 12.805869 0 0 1-12.805869 12.80587H156.72605532a12.805869 12.805869 0 0 1-12.80587-12.80587V259.29928966a12.805869 12.805869 0 0 1 12.80587-12.805869z m239.939305 564.141231h124.53708a41.51236 41.51236 0 0 0 41.51236-41.51236V278.62548066l291.653674 510.335237 0.266789 0.480221a41.619075 41.619075 0 0 0 56.826045 15.527116l107.932136-62.962191A42.600859 42.600859 0 0 0 1034.18422332 684.02729066L727.73976932 147.49337866l-0.266789-0.48022a41.619075 41.619075 0 0 0-56.826045-15.527116l-107.932135 62.962191V84.17902666A41.51236 41.51236 0 0 0 521.20244032 42.66666666h-124.53708a41.51236 41.51236 0 0 0-41.51236 41.51236v684.943265a41.51236 41.51236 0 0 0 41.51236 41.51236z m296.295802-597.938055a3.735045 3.735045 0 0 1 5.122348 1.376631l259.841761 454.608363a12.805869 12.805869 0 0 1-4.663471 17.415982l-56.271124 32.825712a12.805869 12.805869 0 0 1-17.544041-4.663471L624.11894332 267.59109066a12.805869 12.805869 0 0 1 4.663471-17.415983zM426.49236432 101.20016166h64.883072a12.805869 12.805869 0 0 1 12.805869 12.805869v625.289257a12.805869 12.805869 0 0 1-12.805869 12.80587h-64.883072a12.805869 12.805869 0 0 1-12.805869-12.80587V114.00603066a12.805869 12.805869 0 0 1 12.805869-12.805869z m0 0"
                                      p-id="2227" fill="#ffffff"></path>
                            </svg>&nbsp;&nbsp;我的书架</a></li>
                        <li><a href="#wallet">
                            <svg t="1601956557043" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" p-id="3889" width="22" height="22">
                                <path d="M884.363636 857.367273H116.363636c-25.6 0-46.545455-20.945455-46.545454-46.545455v-628.363636c0-25.6 20.945455-46.545455 46.545454-46.545455h488.96c12.8 0 23.272727 10.472727 23.272728 23.272728s-10.472727 23.272727-23.272728 23.272727H116.363636v628.363636h768v-628.363636h-93.090909c-12.8 0-23.272727-10.472727-23.272727-23.272727s10.472727-23.272727 23.272727-23.272728h93.090909c25.6 0 46.545455 20.945455 46.545455 46.545455v628.363636c0 25.6-20.945455 46.545455-46.545455 46.545455z"
                                      fill="#ffffff" p-id="3890"></path>
                                <path d="M907.636364 636.276364h-209.454546c-77.032727 0-139.636364-62.603636-139.636363-139.636364 0-37.236364 14.429091-72.378182 40.727272-98.676364A138.891636 138.891636 0 0 1 698.181818 357.003636h209.454546c12.8 0 23.272727 10.472727 23.272727 23.272728v232.727272c0 12.8-10.472727 23.272727-23.272727 23.272728z m-209.454546-232.727273c-24.901818 0-48.174545 9.774545-65.861818 27.461818-17.687273 17.454545-27.229091 40.727273-27.229091 65.629091 0 51.432727 41.658182 93.090909 93.090909 93.090909h186.181818v-186.181818h-186.181818z"
                                      fill="#ffffff" p-id="3891"></path>
                                <path d="M791.272727 566.458182c-38.4 0-69.818182-31.418182-69.818182-69.818182s31.418182-69.818182 69.818182-69.818182 69.818182 31.418182 69.818182 69.818182-31.418182 69.818182-69.818182 69.818182z m0-93.090909c-12.8 0-23.272727 10.472727-23.272727 23.272727s10.472727 23.272727 23.272727 23.272727 23.272727-10.472727 23.272728-23.272727-10.472727-23.272727-23.272728-23.272727z"
                                      fill="#ffffff" p-id="3892"></path>
                            </svg>
                            &nbsp;我的钱包</a></li>
                        <li><a href="#user">
                            <svg t="1601956464956" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" p-id="2959" width="22" height="22">
                                <path d="M504.6 540.5c62-39.8 103.1-109.4 103.1-188.6 0-123.7-100.2-223.9-223.9-223.9S159.9 228.2 159.9 351.9c0 79.2 41.1 148.8 103.1 188.6C145.9 586.3 63.3 697.3 63.3 831H129c8-133.8 119.1-233.9 254.9-233.9S630.8 697.2 638.8 831h65.5c0-133.7-82.6-244.7-199.7-290.5zM221.8 352c0-88.4 71.6-160 160-160s160 71.6 160 160-71.6 160-160 160-160-71.6-160-160z"
                                      p-id="2960" fill="#ffffff"></path>
                                <path d="M553 128h23.1l0.2-64h320.2c35.6 0 64.5 28.9 64.5 64.5v638c0 35.6-28.9 64.5-64.5 64.5H768.3v-64h91.4c20.6 0 37.3-16.7 37.3-37.3V165.3c0-20.6-16.7-37.3-37.3-37.3H576.1m192.2 639"
                                      p-id="2961" fill="#ffffff"></path>
                                <path d="M640 192h192v64H640zM640 320h192v64H640zM640 448h192v64H640zM704 576h128v64H704z"
                                      p-id="2962" fill="#ffffff"></path>
                            </svg>
                            &nbsp;个人资料</a></li>
                        <li><a href="#setPassword">
                            <svg t="1602215289328" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" p-id="2549" width="20" height="20">
                                <path d="M724.884017 313.943179c-15.445784 3.990894-31.31624-4.866844-35.462676-19.814278l-12.270465-47.209208c-25.959232-93.755314-114.480334-149.46922-214.95263-123.437333-101.489462 26.329668-145.786341 118.202099-120.28555 210.383568l19.554358 84.8372c4.109598 14.911618-5.046946 30.250978-20.453844 34.277688-15.445784 3.990894-31.306007-4.856611-35.450397-19.815301l-19.517519-84.790128C252.252653 226.358401 314.94346 103.703897 447.239556 69.414953c131.775232-34.156938 251.420193 38.95522 285.768489 163.043377l12.317537 47.197952C749.447459 294.614971 740.32673 309.952284 724.884017 313.943179L724.884017 313.943179zM769.841951 958.677249 249.280972 958.677249c-63.779605 0-115.691929-50.218752-115.691929-111.947651L133.589043 510.812965c0-61.742203 51.9113-111.960954 115.691929-111.960954l520.56098 0c63.816444 0 115.691929 50.218752 115.691929 111.960954l0 335.916633C885.532857 908.458497 833.658396 958.677249 769.841951 958.677249L769.841951 958.677249zM827.711963 510.812965c0-30.864962-25.962302-55.986105-57.871035-55.986105L249.280972 454.826859c-31.872918 0-57.821917 25.121144-57.821917 55.986105l0 335.916633c0 30.840402 25.948999 55.972802 57.821917 55.972802l520.56098 0c31.908734 0 57.871035-25.133424 57.871035-55.972802L827.712987 510.812965 827.711963 510.812965zM509.584486 678.735465c-31.940456 0-57.856709-25.038256-57.856709-55.974849 0-30.912034 25.915229-55.972802 57.856709-55.972802 31.956829 0 57.82294 25.060769 57.82294 55.972802C567.406402 653.697209 541.540292 678.735465 509.584486 678.735465L509.584486 678.735465zM509.584486 790.730189c-15.965623 0-28.933983-12.529361-28.933983-28.022217L480.650503 650.760321c0-15.443737 12.968359-27.999704 28.933983-27.999704 15.965623 0 28.924773 12.55699 28.924773 27.999704l0 111.947651C538.508235 778.200828 525.549086 790.730189 509.584486 790.730189L509.584486 790.730189z"
                                      p-id="2550" fill="#ffffff"></path>
                            </svg>&nbsp;&nbsp;修改密码
                        </a></li>
                        <li><a href="#userIdentity">
                            <svg t="1602215195299" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" p-id="1712" width="22" height="22">
                                <path d="M880.5 176h-737C99.7 176 64 211.7 64 255.5v513c0 43.8 35.7 79.5 79.5 79.5h737c43.9 0 79.5-35.7 79.5-79.5v-513c0-43.8-35.7-79.5-79.5-79.5zM904 768.5c0 13-10.6 23.5-23.5 23.5h-737c-13 0-23.5-10.6-23.5-23.5v-513c0-13 10.6-23.5 23.5-23.5h737c13 0 23.5 10.6 23.5 23.5v513zM406.5 341.6H227c-15.4 0-28 12.5-28 28s12.6 28 28 28h179.5c15.5 0 28-12.5 28-28s-12.6-28-28-28z m0 139H227c-15.4 0-28 12.5-28 28s12.6 28 28 28h179.5c15.5 0 28-12.5 28-28 0-15.4-12.6-28-28-28z m0 138.9H227c-15.4 0-28 12.5-28 28s12.6 28 28 28h179.5c15.5 0 28-12.5 28-28s-12.6-28-28-28z m331-99.3c20.3-20.3 32.9-48.3 32.9-79.2 0-61.8-50.2-112-112-112s-112 50.2-112 112c0 29.3 11.6 55.9 30.1 75.9C523 545 486 600.5 486 665.1c0 15.5 12.5 28 28 28s28-12.5 28-28c0-61.8 50.3-112 112-112s112 50.2 112 112c0 15.5 12.5 28 28 28s28-12.5 28-28c-0.1-62.1-34.3-115.8-84.5-144.9zM658.3 385c30.8 0 56 25.1 56 56s-25.2 56-56 56-56-25.1-56-56c0-30.8 25.2-56 56-56z"
                                      p-id="1713" fill="#ffffff"></path>
                            </svg>&nbsp;&nbsp;实名认证
                        </a></li>
                        <li><a href="#">
                            <svg t="1602215371928" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" p-id="2834" width="20" height="20">
                                <path d="M789.504 890.368H319.488c-18.432 0-33.28 14.848-33.28 33.28s14.848 33.28 33.28 33.28h470.016c18.432 0 33.28-14.848 33.28-33.28s-14.848-33.28-33.28-33.28z"
                                      fill="#ffffff" p-id="2835"></path>
                                <path d="M731.648 392.192c68.096-118.272 79.36-283.136 79.872-289.792 1.024-12.288-5.632-24.576-16.384-30.72-10.752-6.144-24.064-6.144-34.816 0.512-24.576 15.872-241.152 156.16-287.744 235.52-68.096 114.688-235.52 420.864-237.056 423.936-1.536 2.56-2.048 5.12-3.072 7.68l-91.648 158.72c-9.216 15.872-3.584 36.352 12.288 45.568 5.12 3.072 10.752 4.608 16.384 4.608 11.264 0 22.528-6.144 28.672-16.896L291.84 769.536c58.368-39.936 371.2-258.048 439.808-377.344z m-201.728-51.2c23.04-39.424 122.368-115.2 206.336-173.056-9.216 54.272-27.648 130.56-61.952 190.976-39.936 68.608-190.976 189.952-310.272 278.016 54.272-98.816 126.464-229.376 165.888-295.936z"
                                      fill="#ffffff" p-id="2836"></path>
                            </svg>&nbsp;&nbsp;作者平台
                        </a></li>
                    </ul>
                </nav>
                <!-- footer -->
                <div class="footer mt-auto">
                    <!-- copyright -->
                    <span class="copyright">© 2020 {{ request.user }}</span>
                </div>
            </div>
        </header>

        <!-- main content area -->
        <main class="content float-right">
            <!-- section shelf -->
            <section id="shelf" class="shadow-blue white-bg padding">
                <h3 class="section-title">我的书架</h3>
                <div class="spacer" data-height="80"></div>

                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home"
                           role="tab" aria-controls="nav-home" aria-selected="true">书架1</a>
                        <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile"
                           role="tab" aria-controls="nav-profile" aria-selected="false">书架2</a>
                        <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact"
                           role="tab" aria-controls="nav-contact" aria-selected="false">书架3</a>
                    </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                        <div class="con">
                            <ul>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20201004/532c28d21b123800d1dac2db0fcda0f5.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p><a href="">最新章节: 第xxx章 我也不知道是什么章节</a></p>
                                    </div>
                                </li>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20200927/960e679eacbd6ac26cd03ee981267711.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p>为您铺就成为IT大神的在线学习之路</p>
                                    </div>
                                </li>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20201004/532c28d21b123800d1dac2db0fcda0f5.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p><a href="">最新章节: 第xxx章 我也不知道是什么章节</a></p>
                                    </div>
                                </li>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20201004/532c28d21b123800d1dac2db0fcda0f5.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p><a href="">最新章节: 第xxx章 我也不知道是什么章节</a></p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                        <div class="con">
                            <ul>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20201004/532c28d21b123800d1dac2db0fcda0f5.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p><a href="">最新章节: 第xxx章 我也不知道是什么章节</a></p>
                                    </div>
                                </li>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20200927/960e679eacbd6ac26cd03ee981267711.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p>为您铺就成为IT大神的在线学习之路</p>
                                    </div>
                                </li>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20201004/532c28d21b123800d1dac2db0fcda0f5.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p><a href="">最新章节: 第xxx章 我也不知道是什么章节</a></p>
                                    </div>
                                </li>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20201004/532c28d21b123800d1dac2db0fcda0f5.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p><a href="">最新章节: 第xxx章 我也不知道是什么章节</a></p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
                        <div class="con">
                            <ul>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20201004/532c28d21b123800d1dac2db0fcda0f5.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p><a href="">最新章节: 第xxx章 我也不知道是什么章节</a></p>
                                    </div>
                                </li>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20200927/960e679eacbd6ac26cd03ee981267711.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p>为您铺就成为IT大神的在线学习之路</p>
                                    </div>
                                </li>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20201004/532c28d21b123800d1dac2db0fcda0f5.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p><a href="">最新章节: 第xxx章 我也不知道是什么章节</a></p>
                                    </div>
                                </li>
                                <li>
                                    <img style="object-fit: cover;"
                                         src="http://alioss.youdubook.com/uploads/20201004/532c28d21b123800d1dac2db0fcda0f5.jpg"
                                         alt=""/>
                                    <div class="txt">
                                        <a href="#">弗雷尔卓德的孤狼</a>
                                        <p><a href="">最新章节: 第xxx章 我也不知道是什么章节</a></p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>
            <!-- section wallet -->
            <section id="wallet" class="shadow-blue white-bg padding">
                <h3 class="section-title">我的钱包</h3>
                <div class="spacer" data-height="80"></div>

                <div class="row">
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">月票</h5>
                                <span style="font-size: 20px; font-weight: bold">{{ request.user.mon_tickets }}</span>
                                <br>
                                <a href="#" class="btn btn-outline-warning">占格子</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">推荐票</h5>
                                <span style="font-size: 20px; font-weight: bold">{{ request.user.re_tickets }}</span>
                                <br>
                                <a href="#" class="btn btn-outline-success">占格子</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">星币</h5>
                                <span style="font-size: 20px; font-weight: bold">{{ request.user.stars }}</span>
                                <br>
                                <a data-toggle="modal" data-target="#rechargeModal"
                                   class="btn btn-outline-danger">充值</a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- section user -->
            <section id="user" class="shadow-blue white-bg padding">
                <h3 class="section-title">个人资料</h3>
                <div class="spacer" data-height="80"></div>

                <div class="row">

                    <div class="col-md-4 mb-4 mb-md-0">
                        <!-- wallet info -->
                        <div class="wallet-info mb-5">
                            <i class="icon-phone"></i>
                            <div class="details">
                                <h5>账号</h5>
                                <span>{{ request.user.username }}</span>
                            </div>
                        </div>
                        <div class="wallet-info mb-5">
                            <i class="icon-envelope"></i>
                            <div class="details">
                                <h5>邮箱</h5>
                                <span>{{ request.user.email }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-8">
                        <!-- wallet Form -->
                        <form id="user-info-form" class="wallet-form">
                            <div class="row">
                                <div class="column col-md-12">
                                    <div class="form-group">
                                        <img id="head-img" class="upload-avatar img-thumbnail"
                                             src="/media/{{ request.user.avatar }}"
                                             alt="{{ request.user }}"/>
                                        <input type="file" id="input_head" name="file" onchange="preview(this)">上传头像
                                    </div>
                                </div>
                                <div class="column col-md-4">
                                    <div class="form-group">
                                        <label style="color: #000; font-weight: bold" for="InputNickname">昵称:</label>
                                        <input class="form-control" name="nickname" id="InputNickname"
                                               value="{{ request.user.nickname }}">
                                        <div class="help-block with-errors"></div>
                                    </div>
                                </div>
                                <div class="column col-md-4">
                                    <div class="form-group">
                                        <label style="color: #000; font-weight: bold" for="InputGender">性别:</label>
                                        <select class="form-control" name="gender" id="InputGender">
                                            {% for choice in GENDER %}
                                                <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="column col-md-12">
                                    <div class="form-group">
                                        <label style="color: #000; font-weight: bold" for="InputDesc">个性签名:</label>
                                        <textarea name="InputDesc"
                                                  id="InputDesc"
                                                  class="form-control" rows="5"
                                                  required="required"
                                                  data-error="Message is required.">{{ request.user.desc }}</textarea>
                                        <div class="help-block with-errors"></div>
                                    </div>
                                </div>
                            </div>

                            <button onclick="modifyInfo();" type="button" class="btn btn-default">
                                <svg t="1601967461369" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                     xmlns="http://www.w3.org/2000/svg" p-id="1842" width="20" height="20">
                                    <path d="M486.577954 156.09136h101.688183v203.376366a101.688183 101.688183 0 0 1-101.688183 101.688183h-152.532274a101.688183 101.688183 0 0 1-101.688182-101.688183v-203.376366h101.688182v203.376366h152.532274z m-279.642502-101.688182H610.129096a152.532274 152.532274 0 0 1 108.806356 47.285005l208.460774 217.612711a152.532274 152.532274 0 0 1 42.200596 105.247269v392.516385a152.532274 152.532274 0 0 1-152.532274 152.532274h-610.129096a152.532274 152.532274 0 0 1-152.532274-152.532274v-610.129096a152.532274 152.532274 0 0 1 152.532274-152.532274z m0 101.688182a50.844091 50.844091 0 0 0-50.844092 50.844092v610.129096a50.844091 50.844091 0 0 0 50.844092 50.844092h610.129096a50.844091 50.844091 0 0 0 50.844092-50.844092V424.548163a50.844091 50.844091 0 0 0-14.236346-35.082423L645.71996 171.853029a50.844091 50.844091 0 0 0-35.590864-15.761669z"
                                          fill="#ffffff" p-id="1843"></path>
                                </svg>
                                保存修改
                            </button>
                        </form>
                        <!-- wallet Form end -->
                    </div>
                </div>
            </section>

            <!-- section password -->
            <section id="setPassword" class="shadow-blue white-bg padding">
                <h3 class="section-title">修改密码 </h3>
                <div class="spacer" data-height="80"></div>
                <div class="row">
                    <div class="col-md-8">
                        <form id="user-info-form" class="wallet-form">
                            <div class="row">
                                <div class="column col-md-12">
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-7">
                                                <label style="color: #000; font-weight: bold" for="InputOldPassword">原密码:</label>

                                                <input class="form-control" name="oldPassword" id="InputOldPassword"
                                                       placeholder="请输入您的原密码"
                                                       type="password">
                                                <div class="invalid-feedback"></div>
                                            </div>
                                            <a style="margin-top: 7%;" type="button" data-toggle="modal"
                                               data-target="#modifyPasswordModal">忘记密码?</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="column col-md-7">
                                    <div class="form-group">
                                        <label style="color: #000; font-weight: bold"
                                               for="InputNewPassword">新密码:</label>
                                        <input class="form-control" name="newPassword" id="InputNewPassword"
                                               placeholder="请输入您的新密码"
                                               type="password">
                                        <div class="invalid-feedback"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="column col-md-7">
                                    <div class="form-group">
                                        <label style="color: #000; font-weight: bold"
                                               for="InputReNewPassword">再次输入:</label>
                                        <input class="form-control" name="re_newPassword" id="InputReNewPassword"
                                               placeholder="请再次输入您的新密码"
                                               type="password">
                                        <div class="invalid-feedback"></div>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-default" type="button" onclick="modifyPassword();">
                                <svg t="1601967461369" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                     xmlns="http://www.w3.org/2000/svg" p-id="1842" width="20" height="20">
                                    <path d="M486.577954 156.09136h101.688183v203.376366a101.688183 101.688183 0 0 1-101.688183 101.688183h-152.532274a101.688183 101.688183 0 0 1-101.688182-101.688183v-203.376366h101.688182v203.376366h152.532274z m-279.642502-101.688182H610.129096a152.532274 152.532274 0 0 1 108.806356 47.285005l208.460774 217.612711a152.532274 152.532274 0 0 1 42.200596 105.247269v392.516385a152.532274 152.532274 0 0 1-152.532274 152.532274h-610.129096a152.532274 152.532274 0 0 1-152.532274-152.532274v-610.129096a152.532274 152.532274 0 0 1 152.532274-152.532274z m0 101.688182a50.844091 50.844091 0 0 0-50.844092 50.844092v610.129096a50.844091 50.844091 0 0 0 50.844092 50.844092h610.129096a50.844091 50.844091 0 0 0 50.844092-50.844092V424.548163a50.844091 50.844091 0 0 0-14.236346-35.082423L645.71996 171.853029a50.844091 50.844091 0 0 0-35.590864-15.761669z"
                                          fill="#ffffff" p-id="1843"></path>
                                </svg>
                                修改密码
                            </button>

                        </form>
                        <!-- wallet Form end -->
                    </div>

                </div>

            </section>

            <!-- section userIdentity -->
            <section id="userIdentity" class="shadow-blue white-bg padding">
                <h3 class="section-title">实名认证 </h3>
                <div class="spacer" data-height="80"></div>
                {% if not request.user.is_identity %}
                    <div class="row">
                        <div class="col-md-8">
                                <form id="user-info-form" class="wallet-form">
                                    <div class="row">
                                        <div class="column col-md-12">
                                            <div class="form-group">
                                                <div class="row">
                                                    <div class="col-7">
                                                        <label style="color: #000; font-weight: bold" for="InputPersonName">真实姓名:</label>

                                                        <input class="form-control" id="InputPersonName"
                                                               placeholder="请输入您的真实姓名"
                                                               type="text">
                                                        <div class="invalid-feedback"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="column col-md-7">
                                            <div class="form-group">
                                                <label style="color: #000; font-weight: bold"
                                                       for="InputIdCard">身份证号:</label>
                                                <input class="form-control" id="InputIdCard"
                                                       placeholder="请输入您的身份证号"
                                                       type="text">
                                                <div class="invalid-feedback"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="btn btn-default" type="button" onclick="identityUser();">
                                        实名认证
                                    </button>
                                </form>
                        </div>
                    </div>
                {% else %}
                    <div class="row justify-content-center align-self-center">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header text-center">
                                    <h4>已通过实名认证</h4>
                                </div>
                                <div class="card-body" style="padding: 2.5rem;">
                                    <strong>真实姓名:&nbsp;</strong> *{{ request.user.identity.name|last }}
                                    <br><br>
                                    <strong>证件号码:&nbsp;</strong> {{ request.user.identity.id_card|slice:":6" }}***{{ request.user.identity.id_card|slice:"-4:" }}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

            </section>
        </main>
    </div>
{% endblock %}

{% block scripts %}
    <script src="https://cdn.bootcdn.net/ajax/libs/cropper/4.0.0/cropper.min.js"></script>
    <script type="text/javascript">
        // 书籍封面的特效
        $(".con ul li").hover(function () {
            $(this).find(".txt").stop().animate({height: "50%"}, 400);
            $(this).find(".txt h3").stop().animate({paddingTop: "60px"}, 400);
        }, function () {
            $(this).find(".txt").stop().animate({height: "45px"}, 400);
            $(this).find(".txt h3").stop().animate({paddingTop: "0px"}, 400);
        });

        // 充值按钮点击事件
        function recharge() {
            let count = $('#rechargeNum').val();  //获取充值的数额
            $.ajax({
                type: 'POST',
                url: '{% url "Users:modify_stars" %}',
                contentType: 'application/json', //以json格式传数据
                dataType: 'json',
                data: JSON.stringify({
                    "count": count
                }),
                success: function (data) {
                    $('#rechargeModal').modal('hide');
                    $('#rechargeNum').val(null);
                },
                error: function (e) {
                    //这里之后根据错误信息来进行提示
                    console.log(e);
                }
            });
        }

        // 修改个人资料点击事件
        function modifyInfo() {
            let nickname = $('#InputNickname').val();  // 昵称
            let gender = $('#InputGender').val();  // 性别
            let desc = $('#InputDesc').val();  // 个性签名
            // 后期加上数据验证
            let fd = new FormData();
            fd.append('nickname', nickname);
            fd.append('gender', gender);
            fd.append('desc', desc);
            fd.append('head-img', window.headImg);
            $.ajax({
                type: 'POST',
                url: '{% url "Users:modify_userInfo" %}',
                data: fd,
                processData: false,
                contentType: false,
                success: function (data) {
                    location.reload();  //修改成功,刷新页面
                    $.message('修改个人资料成功');
                },
                error: function (e) {
                    //这里之后根据错误信息来进行提示
                    console.log(e);
                }
            });
        }

        // 修改密码点击事件
        function modifyPassword() {
            let oldPassword = $('#InputOldPassword');
            let newPassword = $('#InputNewPassword');
            let reNewPassword = $('#InputReNewPassword');
            oldPassword.removeClass('is-invalid');
            newPassword.removeClass('is-invalid');
            reNewPassword.removeClass('is-invalid');
            if (!oldPassword.val()) {
                oldPassword.addClass('is-invalid');
                oldPassword.next('div').text('原密码不能为空!');
                return null;
            }
            if (!newPassword.val()) {
                newPassword.addClass('is-invalid');
                newPassword.next('div').text('新密码不能为空!');
                return null;
            }
            if (!reNewPassword.val()) {
                reNewPassword.addClass('is-invalid');
                reNewPassword.next('div').text('密码不能为空!');
                return null;
            }
            if (reNewPassword.val() !== newPassword.val()) {
                newPassword.addClass('is-invalid');
                newPassword.next('div').text('两次密码不一致!');
                reNewPassword.addClass('is-invalid');
                reNewPassword.next('div').text('两次密码不一致!');
                return null;
            }
            $.ajax({
                type: 'POST',
                url: '{% url 'Users:modify_password' %}',
                data: {
                    old_password: oldPassword.val(),
                    new_password: newPassword.val()
                },
                success: function (data) {
                    $.message('修改密码成功');
                },
                error: function (e) {

                }
            });
        }

        {% if request.user.is_identity %}
            // 实名认证按钮点击事件
            function identityUser() {
                let $personName = $('#InputPersonName');
                let $idCard = $('#InputIdCard');
                $personName.removeClass('is-invalid');  // 取消错误提示
                $idCard.removeClass('is-invalid');
                if (!$personName.val()) {
                    $personName.addClass('is-invalid');
                    $personName.next('div').text('姓名不能为空!');
                }
                if (!$idCard.val()) {
                    $idCard.addClass('is-invalid');
                    $idCard.next('div').text('身份证号不能为空!');
                }
                $.ajax({
                    url: "{% url 'Users:user_identity' %}",
                    type: 'POST',
                    data: {
                        name: $personName.val(),
                        id_card: $idCard.val()
                    },
                    success: function () {
                        $.message('实名认证成功!');
                        location.reload();
                    },
                })
            }
        {% endif %}
    </script>
    <script>
        function preview(obj) {
            let upload_modal = $('#upload-modal');
            let uploadPreview = $('#uploadPreview');
            let val = obj.value;
            let upLoadType = '.jpg,.gif,.bmp,.png,.jpeg';
            let fileExt = val.substr(val.lastIndexOf('.')).toLowerCase();
            let result = upLoadType.indexOf(fileExt);
            let oFile = obj.files[0];
            if (val === '') {
                console.log('没有选择文件');
                return null;
            }
            if (obj.files.length === 0 || result < 0) {
                alert('请上传正确格式的文件 jpg|png|bmp|png|jpeg');
                document.getElementById('uploadPreview').parentElement.style.display = 'none';
                return null;
            }
            if (oFile.size / 1024 > 3072) {
                alert('请上传3mb以内的文件!!');
                document.getElementById('uploadPreview').parentElement.style.display = 'none';
                return null;
            }
            upload_modal.on('show.bs.modal', function () {
                let blobURL;
                let URL = window.URL || window.webkitURL;
                blobURL = URL.createObjectURL(oFile);
                document.getElementById('uploadPreview').parentElement.style.display = 'block';
                document.getElementById('uploadPreview').src = blobURL;

                uploadPreview.cropper({
                    aspectRatio: 1,
                    viewMode: 1,
                    ready: function (data) {

                    }
                });

                uploadPreview.cropper('reset').cropper('replace', blobURL);
            });

            $('#sendPhoto').on('click', function () {
                $('#uploadPreview').cropper('getCroppedCanvas', {
                    width: 150,
                    height: 150,
                }).toBlob(function (blob) {
                    document.getElementById('head-img').src = URL.createObjectURL(blob);
                    window.headImg = blob;  // 后面上传时会用到
                    upload_modal.modal('hide');
                    obj.value = null;
                });
            });

            upload_modal.modal('show');
        }

        $('#upload-modal').on('hide.bs.modal', function (e) {
            document.getElementById('error_text').style.display = 'none';
            document.getElementById('uploadPreview').src = '';
            $('#input_head').val(null);  // 将输入框的值设置为空
            $('#uploadPreview').cropper('rest').cropper('replace', '');
            $('#uploadPreview').cropper('destroy');
        });
    </script>
{% endblock %}
